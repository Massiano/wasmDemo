name: Delete All Workflow Runs

on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Dry run (list runs without deleting)'
        required: false
        default: 'false'
        type: boolean

jobs:
  delete-runs:
    runs-on: ubuntu-latest
    permissions:
      actions: write
    steps:
      - name: Delete workflow runs
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const dryRun = '${{ inputs.dry_run }}' === 'true';
            
            let deleted = 0;
            let page = 1;
            
            while (true) {
              const runs = await github.rest.actions.listWorkflowRunsForRepo({
                owner,
                repo,
                per_page: 100,
                page
              });
              
              if (runs.data.workflow_runs.length === 0) break;
              
              for (const run of runs.data.workflow_runs) {
                if (dryRun) {
                  console.log(`Would delete: ${run.id} - ${run.name} (${run.created_at})`);
                } else {
                  await github.rest.actions.deleteWorkflowRun({
                    owner,
                    repo,
                    run_id: run.id
                  });
                  console.log(`Deleted: ${run.id} - ${run.name}`);
                }
                deleted++;
              }
              
              // If not dry run, stay on page 1 since we're deleting
              if (dryRun) page++;
            }
            
            console.log(`\n${dryRun ? 'Would delete' : 'Deleted'} ${deleted} workflow runs`);
